<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tic Tac Toe - Game</title>
    <%- include('./partials/bootStrapCSS') %>
</head>

<body class="bg-light">
    <%- include('./partials/nav') %>

        <div class="container mt-5">

            <div class="d-flex justify-content-center">
                <div class="d-grid" style="grid-template-columns: repeat(3, 110px); gap: 15px;">
                    <% for(let i=0; i<3; i++) { %>
                        <% for(let j=0; j<3; j++) { %>

                            <button onclick="playMove('<%= game %>','<%= turn %>', '<%= i %>', '<%= j %>')"
                                class="btn btn-outline-dark fs-1 fw-bold d-flex justify-content-center align-items-center rounded shadow-sm"
                                style="width:110px; height:110px;" <% if (locals.game[i][j] || locals.winner) { %>
                                disabled <% } %>>

                                    <% if (locals.game[i][j]) { %>
                                        <%= game[i][j] %>
                                            <% } %>
                            </button>

                            <% } %>
                                <% } %>
                </div>
            </div>


            <div class="mt-5">
                <div class="table-responsive">
                    <table class="table table-striped table-bordered text-center fs-3 shadow-sm">
                        <thead class="table-dark">
                            <tr>
                                <th class="p-3">
                                    <%= player1 %>
                                </th>
                                <th class="p-3">
                                    <%= player2 %>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="p-3">
                                    <%= p1win %>
                                </td>
                                <td class="p-3">
                                    <%= p2win %>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>


            <% if (locals.winner) { %>
                <div class="text-center mt-4">
                    <div class="alert alert-info fs-2 fw-semibold w-50 mx-auto">
                        <% if (locals.winner==='draw' ) { %>
                            It's a Draw!
                            <% } else { %>
                                <%= winner %> Won!
                                    <% } %>
                    </div>
                </div>
                <% } %>


                    <% if (locals.winner) { %>
                        <div class="text-center mt-3 mb-5">
                            <button class="btn btn-success btn-lg px-5 shadow" onclick="playAgain()">
                                Play Again
                            </button>
                        </div>
                        <% } %>

        </div>


        <script>
            function playMove(game, turn, i, j) {
                game[i][j] = turn;
                fetch('/play', {
                    method: 'post',
                    headers: { "content-type": 'application/json' },
                    body: JSON.stringify({ i, j })
                }).then(() => window.location.reload());
            }

            function playAgain() {
                fetch('/playagain', {
                    method: 'post',
                    headers: { "content-type": 'application/json' },
                    body: JSON.stringify({ rematch: true })
                }).then(() => window.location.reload());
            }
        </script>

        <%- include('./partials/bootStrapJs') %>

</body>

</html>